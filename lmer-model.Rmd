---
title: "Modelling"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(cowplot)
library(gplots)
library(ggplot2)
library(patternplot)
library(lme4)
library(visreg)
library(tidyr)
library(magrittr) 
library(dplyr)
library(ggpubr)
library(lme4)
library(lsmeans)
library(emmeans)

info<-read.csv("apoe22_33_44__2HN_3HN_4HN_mwm_combined copy.csv", header=TRUE)

reg_trials<-info %>% 
  filter(Sex != "FHet") %>% 
  filter(Stage != "Probe_D5" | Stage != "Probe_D8") %>% 
  # aesthetic purposes:
  mutate(Day = case_when( 
    Stage == "Day1" ~ 1,
    Stage == "Day2" ~ 2,
    Stage == "Day3" ~ 3,
    Stage == "Day4" ~ 4,
    Stage == "Day5" ~ 5
  )) %>% 
  filter(! is.na(Day)) %>% 
  mutate(Sex = case_when(
    Sex == "F" ~ "Female",
    Sex == "M" ~ "Male"
  )) 

probe_trials<-info %>% 
  filter(Sex != "FHet") %>% 
  filter(Stage == "Probe_D5" | Stage == "Probe_D8") %>% 
  # aesthetic purposes:
  mutate(Day = case_when( 
    Stage == "Probe_D5" ~ 1,
    Stage == "Probe_D8" ~ 2,
  )) %>% 
  filter(! is.na(Day)) %>% 
  mutate(Sex = case_when(
    Sex == "F" ~ "Female",
    Sex == "M" ~ "Male"
  )) 

# correcting for errors from Any Maze (taken from Andrei's script)
reg_trials$Distance=reg_trials$Distance/10
reg_trials$NE.distance=reg_trials$NE.distance/10
reg_trials$NW.distance=reg_trials$NW.distance/10
reg_trials$SE.distance=reg_trials$SE.distance/10
reg_trials$SW.distance=reg_trials$SW.distance/10

#Normalize time and distance in target region
reg_trials$NormSWTime<-reg_trials$SW.time/reg_trials$Duration
reg_trials$NormSWDist<-reg_trials$SW.distance/reg_trials$Distance
reg_trials<-subset(reg_trials, (NormSWTime <= 1))

reg_trials$NormSWDist <- as.numeric(reg_trials$NormSWDist)
probe_trials$NormSWDist <- as.numeric(probe_trials$NormSWDist)

hn_trials <- reg_trials %>% 
  filter(APOE == "E2HN" | APOE == "E3HN" | APOE == "E4HN") 

hn_probe <- probe_trials %>% 
  filter(APOE == "E2HN" | APOE == "E3HN" | APOE == "E4HN") 

e_trials <- reg_trials %>% 
  filter(APOE == "E22" | APOE == "E33" | APOE == "E44")

e_probe <- probe_trials %>% 
  filter(APOE == "E22" | APOE == "E33" | APOE == "E44")

e2 <- reg_trials %>% 
  filter(APOE == "E2HN" | APOE == "E22")

e2_probe <- probe_trials %>% 
  filter(APOE == "E2HN" | APOE == "E22")

e3_probe <- probe_trials %>% 
  filter(APOE == "E3HN" | APOE == "E33")

e4 <- reg_trials %>% 
  filter(APOE == "E4HN" | APOE == "E44")

e4_probe <- probe_trials %>% 
  filter(APOE == "E4HN" | APOE == "E44")
```

```{r post-hoc}
fm1<-lmer(NormSWDist ~ Stage*APOE*Sex*Diet+(1 | Animal), probe_trials)

summary(fm1)

anova(fm1)

model<-emmeans(fm1, "Sex", adjust = "Tukey")
pairs(model)
```